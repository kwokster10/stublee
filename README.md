# Movie Rating App
- This app was created to play around with Devise, CanCan, and the use of [repond_to format.js {}](http://guides.rubyonrails.org/working_with_javascript_in_rails.html) through Ruby on Rails. The idea is to have an admin user that can rate movies they had watched, and allow other users to view (no login required) and comment (login required).

## Set Up For App:
1. Ensure you have ruby installed and rails gem installed.
1. `rails new app_name -d postgresql` where app_name is what you would like to name your app.
  - default database is sqlite3 if none specified
1. Maintain a killer README.* to document your process or explain how to run your app.
1. Set up a [Github repo](http://kbroman.org/github_tutorial/pages/init.html) if desired.
1. Set up a [Heroku app](https://devcenter.heroku.com/articles/creating-apps) if desired.
1. Use Devise for authentication.
  - add `gem 'devise'` to *Gemfile*
  - run `bundle install`
  - follow the remaining setup steps from [Devise's docs](https://github.com/plataformatec/devise) or notes seen after you run `rails g devise:install`. The instructions by [Rails Girls](http://guides.railsgirls.com/devise/) are especially useful for those using Bootstrap.
1. Add a boolean admin column to Users table.
  - add `t.boolean :admin, default: false` inside the create_table(:users) block in the migration generated by Devise **OR** run `rails g migration AddAdminColumnUsers admin:boolean`. More info on [Changing A Migration](http://guides.rubyonrails.org/v3.2/migrations.html#changing-migrations) or [Creating A Migration](http://guides.rubyonrails.org/v3.2/migrations.html#creating-a-migration).
  - open up the migration and add `, default: false` after :boolean if you chose to create a new migration
  - the second option is also detailed by [Devise: Add Admin Role Option 2](https://github.com/plataformatec/devise/wiki/How-To:-Add-an-Admin-Role#option-2---adding-an-admin-attribute)
1. `bundle exec rake db:setup db:migrate` to setup and migrate database.
  - [Why use bundle exec with rake?](http://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean)
1. Use CanCan to define abilities of admin versus non-admin.
  - add `gem 'cancan'` to *Gemfile*
  - run `bundle install`
  - check out [CanCan Gettting Started docs](https://github.com/ryanb/cancan#getting-started) for more setup instructions on defining abilities
1. Set up [Bootstrap](https://github.com/twbs/bootstrap-sass) if desired.
  - add `gem 'bootstrap-sass', '~> 3.3.6'`
  - run `bundle install`
1. Add gems to allow of image processing and storage
  - `brew install imagemagick`, an [image processor](http://www.imagemagick.org/script/index.php) needed for [Paperclip](https://github.com/thoughtbot/paperclip)
  - `gem 'paperclip', '~> 4.3'` for file attachment management
  - `gem 'paperclip-googledrive-new'` for [file storage with Google Drive](https://github.com/shoaibmalik786/paperclip-googledrive-new). *Note:* I had an issue with the newest version of a gem dependency but using an older version worked. `gem 'google-api-client', '0.8.6'` was added to the Gemfile to fix the `rake google_drive:authorize` task error `LoadError: cannot load such file -- google/api_client`. 
  - set up credentials via [Google Developers Console](https://console.developers.google.com/home) per instructions from paperclip-googledrive gem above
  - `bundle install`
1. Decide other tables needed for app and [Active Record Associations](http://guides.rubyonrails.org/association_basics.html). Add associations to model after it is generated.
  - Users has_many :comments, has_many :ratings (admin only)
  - Movies table (title, release date:date, watched_day:date, image:attachment director_id, rating_id), belongs_to :director, has_one :rating, has_many :comments
      - `rails g model Movie title release_date:date watched_day:date image:attachment director_id:integer:index rating_id:integer:index`
  - Directors table (name), has_many :movies
      - `rails g model Director name`
  - Ratings table (content:text, stars:integer, draft:boolean, movie_id, user_id), belongs_to :user, belongs_to :movie
      - `rails g model Rating content:text stars:integer draft:boolean movie_id:integer:index, user_id:integer:index`
  - Comments table (note:text, user_id, movie_id), belongs_to :user, belongs_to :movie
      - `rails g model Comment note:text user_id:integer:index movie_id:integer:index`
  - check each of the migrations for any errors befor running `rake db:migrate`

